<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Categories</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ddd; padding: 8px; }
      th { background: #f5f5f5; text-align: left; }
      .actions { display: flex; gap: .5rem; }
      .flash-success { color: #1a7f37; }
      .flash-error { color: #b3261e; }
      .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
      a.button { display: inline-block; padding: .4rem .7rem; background:#0d6efd; color:#fff; text-decoration:none; border-radius:4px; }
      a.button.secondary { background:#6c757d; }
      form.inline { display:inline; margin:0; }
      button.danger { background:#dc3545; color:#fff; border:0; padding:.35rem .6rem; border-radius:4px; cursor:pointer; }
    </style>
  </head>
  <body>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul>
        {% for category, message in messages %}
          <li class="flash-{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div class="toolbar">
      <div>
        <a href="{{ url_for('index') }}" class="button secondary">← Back</a>
      </div>
      <div>
        <a href="{{ url_for('create_category') }}" class="button">+ New Category</a>
      </div>
    </div>

    <h1>Categories {% if filter_type %}({{ filter_type }}){% endif %}</h1>

    <p>Filter: 
      <a href="{{ url_for('list_categories') }}">All</a> ·
      <a href="{{ url_for('list_categories', type='Income') }}">Income</a> ·
      <a href="{{ url_for('list_categories', type='Expense') }}">Expense</a>
    </p>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Type</th>
          <th>Name</th>
          <th>Created</th>
          <th>Updated</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for c in categories %}
        <tr>
          <td>{{ c.id }}</td>
          <td>{{ c.type }}</td>
          <td>{{ c.name }}</td>
          <td>{{ c.created_at }}</td>
          <td>{{ c.updated_at }}</td>
          <td class="actions">
            <a href="{{ url_for('edit_category', id=c.id) }}">Edit</a>
            <form class="inline" method="post" action="{{ url_for('delete_category', id=c.id) }}" onsubmit="return confirm('Delete this category?');">
              <button type="submit" class="danger">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="6">No categories yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    {% if config.DEBUG %}
    <form method="post" action="{{ url_for('seed_categories') }}" style="margin-top:1rem;">
      <button type="submit">Seed Default Categories (dev)</button>
    </form>
    {% endif %}
  </body>
</html>
